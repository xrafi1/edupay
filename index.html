<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduPay - School Payment Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #1a73e8;
            --primary-dark: #0d47a1;
            --secondary: #4caf50;
            --secondary-dark: #2e7d32;
            --text-dark: #202124;
            --text-light: #5f6368;
            --background: #ffffff;
            --card-background: #f8f9fa;
            --border: #dadce0;
            --error: #d93025;
            --success: #34a853;
        }

        body {
            background-color: var(--background);
            color: var(--text-dark);
            line-height: 1.6;
        }

        .container {
            width: 100%;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        header {
            width: 100%;
            max-width: 1000px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: var(--background);
            border-bottom: 1px solid var(--border);
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 2rem;
            color: var(--primary);
        }

        .logo h1 {
            font-size: 1.8rem;
            color: var(--primary);
            font-weight: 600;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }

        nav a {
            text-decoration: none;
            color: var(--text-light);
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        nav a:hover, nav a.active {
            background: var(--primary);
            color: white;
        }

        .main-content {
            width: 100%;
            max-width: 1000px;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .card {
            background: var(--card-background);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .card-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .card-header h2 {
            font-size: 1.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-header i {
            font-size: 1.8rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-dark);
        }

        .form-control {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            transition: border 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--secondary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary {
            background: var(--primary);
            color: white;
        }

        .btn-secondary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .login-options {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .login-option {
            flex: 1;
            min-width: 300px;
            text-align: center;
            padding: 30px;
            border-radius: 12px;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease;
        }

        .login-option:hover {
            transform: translateY(-5px);
        }

        .login-option i {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .login-option h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--text-dark);
        }

        .login-option p {
            color: var(--text-light);
            margin-bottom: 20px;
        }

        .payment-history {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .payment-history th,
        .payment-history td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .payment-history th {
            background-color: var(--primary);
            color: white;
            font-weight: 500;
        }

        .payment-history tr:nth-child(even) {
            background-color: #f1f8fe;
        }

        .payment-history tr:hover {
            background-color: #e8f0fe;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-paid {
            background-color: #e6f4ea;
            color: var(--success);
        }

        .status-pending {
            background-color: #fce8e6;
            color: var(--error);
        }

        .status-verified {
            background-color: #e6f4ea;
            color: var(--success);
        }

        .dashboard-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .stat-card {
            flex: 1;
            min-width: 200px;
            padding: 20px;
            border-radius: 10px;
            background: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        .stat-card i {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--text-dark);
        }

        .stat-card p {
            color: var(--text-light);
        }

        footer {
            width: 100%;
            max-width: 1000px;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            color: var(--text-light);
            border-top: 1px solid var(--border);
        }

        .alert {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-error {
            background-color: #fce8e6;
            color: var(--error);
            border: 1px solid #f5c0b8;
        }

        .alert-success {
            background-color: #e6f4ea;
            color: var(--success);
            border: 1px solid #b8e6cb;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }

            .login-options {
                flex-direction: column;
            }

            .dashboard-stats {
                flex-direction: column;
            }
        }

        .hidden {
            display: none;
        }

        .view {
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                <h1>EduPay</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="active" id="home-link">Home</a></li>
                    <li><a href="#" id="student-link">Student Login</a></li>
                    <li><a href="#" id="admin-link">Admin Login</a></li>
                    <li><a href="#" id="logout-link" class="hidden">Logout</a></li>
                </ul>
            </nav>
        </header>

        <main class="main-content">
            <!-- Home View -->
            <div id="home-view" class="view">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-info-circle"></i> About EduPay</h2>
                    </div>
                    <p>EduPay is a comprehensive school payment management system that allows students to view their payment history and admins to manage all payment records efficiently.</p>
                    <p>Key features:</p>
                    <ul>
                        <li>Secure student and admin login</li>
                        <li>Monthly payment tracking</li>
                        <li>Payment history review</li>
                        <li>Admin payment verification</li>
                        <li>Responsive design for all devices</li>
                    </ul>
                </div>

                <div class="login-options">
                    <div class="login-option">
                        <i class="fas fa-user-graduate"></i>
                        <h3>Student Login</h3>
                        <p>Access your payment history and monthly statements using your roll number.</p>
                        <button class="btn btn-primary" id="student-btn">Login as Student</button>
                    </div>
                    <div class="login-option">
                        <i class="fas fa-user-shield"></i>
                        <h3>Admin Login</h3>
                        <p>Manage student payments, verify transactions, and generate reports.</p>
                        <button class="btn btn-secondary" id="admin-btn">Login as Admin</button>
                    </div>
                </div>
            </div>

            <!-- Student Login View -->
            <div id="student-login-view" class="view hidden">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-user-graduate"></i> Student Login</h2>
                    </div>
                    <div id="student-login-alert" class="alert alert-error"></div>
                    <form id="student-login-form">
                        <div class="form-group">
                            <label for="roll-number">Roll Number</label>
                            <input type="text" id="roll-number" class="form-control" placeholder="Enter your roll number" required>
                        </div>
                        <button type="submit" class="btn btn-primary" id="student-login-btn">
                            <span id="student-login-text">View Payment History</span>
                            <span id="student-login-spinner" class="hidden loading"></span>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Student Dashboard View -->
            <div id="student-dashboard-view" class="view hidden">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-user-graduate"></i> Student Dashboard</h2>
                    </div>
                    <h3>Payment History for Roll Number: <span id="student-roll"></span></h3>
                    <div id="payment-history-container">
                        <table class="payment-history">
                            <thead>
                                <tr>
                                    <th>Month</th>
                                    <th>Amount</th>
                                    <th>Payment Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="payment-history-body">
                                <!-- Payment history will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    <div id="no-payments-message" class="hidden">
                        <p>No payment records found for this roll number.</p>
                    </div>
                </div>
            </div>

            <!-- Admin Login View -->
            <div id="admin-login-view" class="view hidden">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-user-shield"></i> Admin Login</h2>
                    </div>
                    <div id="admin-login-alert" class="alert alert-error"></div>
                    <form id="admin-login-form">
                        <div class="form-group">
                            <label for="admin-username">Username</label>
                            <input type="text" id="admin-username" class="form-control" placeholder="Enter admin username" required>
                        </div>
                        <div class="form-group">
                            <label for="admin-password">Password</label>
                            <input type="password" id="admin-password" class="form-control" placeholder="Enter admin password" required>
                        </div>
                        <button type="submit" class="btn btn-secondary" id="admin-login-btn">
                            <span id="admin-login-text">Login</span>
                            <span id="admin-login-spinner" class="hidden loading"></span>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Admin Dashboard View -->
            <div id="admin-dashboard-view" class="view hidden">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="fas fa-user-shield"></i> Admin Dashboard</h2>
                    </div>
                    
                    <div class="dashboard-stats">
                        <div class="stat-card">
                            <i class="fas fa-users"></i>
                            <h3 id="total-students">0</h3>
                            <p>Total Students</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-money-bill-wave"></i>
                            <h3 id="total-payments">$0</h3>
                            <p>Total Payments</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-check-circle"></i>
                            <h3 id="payment-completion">0%</h3>
                            <p>Payment Completion</p>
                        </div>
                    </div>

                    <h3>Payment Management</h3>
                    <div class="form-group">
                        <input type="text" id="admin-search" class="form-control" placeholder="Search by roll number...">
                    </div>
                    
                    <div id="admin-payments-container">
                        <table class="payment-history">
                            <thead>
                                <tr>
                                    <th>Record ID</th>
                                    <th>Roll Number</th>
                                    <th>Student Name</th>
                                    <th>Amount</th>
                                    <th>Payment Date</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="admin-payments-body">
                                <!-- Admin payments will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    <div id="no-admin-payments-message" class="hidden">
                        <p>No payment records found.</p>
                    </div>

                    <h3 style="margin-top: 30px;">Add New Payment Record</h3>
                    <form id="add-payment-form">
                        <div class="form-group">
                            <label for="new-roll-number">Roll Number</label>
                            <input type="text" id="new-roll-number" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="new-student-name">Student Name</label>
                            <input type="text" id="new-student-name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="new-amount">Amount</label>
                            <input type="number" id="new-amount" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="new-payment-date">Payment Date</label>
                            <input type="date" id="new-payment-date" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Payment Record</button>
                    </form>
                </div>
            </div>
        </main>

        <footer>
            <p>© 2023 EduPay - School Payment Management System | Designed for educational institutions</p>
        </footer>
    </div>

    <script>
        // Configuration - Replace with your Google Apps Script Web App URL
        const API_URL = "https://script.google.com/macros/s/AKfycbxo2LHBBZR-C0gCWPntBIrmrVs3Termjt9DEDLI5IgXwkWRNREuSSmBRzETcmVOLthu_A/exec";
        
        // Global state
        let currentStudent = null;
        let allPayments = [];

        // DOM Elements
        const homeLink = document.getElementById('home-link');
        const studentLink = document.getElementById('student-link');
        const adminLink = document.getElementById('admin-link');
        const logoutLink = document.getElementById('logout-link');
        const studentBtn = document.getElementById('student-btn');
        const adminBtn = document.getElementById('admin-btn');
        
        // Views
        const homeView = document.getElementById('home-view');
        const studentLoginView = document.getElementById('student-login-view');
        const studentDashboardView = document.getElementById('student-dashboard-view');
        const adminLoginView = document.getElementById('admin-login-view');
        const adminDashboardView = document.getElementById('admin-dashboard-view');

        // Navigation
        homeLink.addEventListener('click', (e) => {
            e.preventDefault();
            showView('home-view');
            updateNav('home');
        });

        studentLink.addEventListener('click', (e) => {
            e.preventDefault();
            showView('student-login-view');
            updateNav('student');
        });

        adminLink.addEventListener('click', (e) => {
            e.preventDefault();
            showView('admin-login-view');
            updateNav('admin');
        });

        logoutLink.addEventListener('click', (e) => {
            e.preventDefault();
            currentStudent = null;
            showView('home-view');
            updateNav('home');
        });

        studentBtn.addEventListener('click', () => {
            showView('student-login-view');
            updateNav('student');
        });

        adminBtn.addEventListener('click', () => {
            showView('admin-login-view');
            updateNav('admin');
        });

        // Student login form
        document.getElementById('student-login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const rollNumber = document.getElementById('roll-number').value;
            
            // Show loading state
            document.getElementById('student-login-text').classList.add('hidden');
            document.getElementById('student-login-spinner').classList.remove('hidden');
            document.getElementById('student-login-btn').disabled = true;
            
            try {
                const result = await callApi('studentLogin', { rollNumber });
                
                if (result.success) {
                    currentStudent = result.student;
                    document.getElementById('student-roll').textContent = currentStudent.rollNumber;
                    await loadStudentPayments(currentStudent.rollNumber);
                    showView('student-dashboard-view');
                    updateNav('student-dashboard');
                } else {
                    showAlert('student-login-alert', result.message, 'error');
                }
            } catch (error) {
                showAlert('student-login-alert', 'An error occurred. Please try again.', 'error');
            } finally {
                // Hide loading state
                document.getElementById('student-login-text').classList.remove('hidden');
                document.getElementById('student-login-spinner').classList.add('hidden');
                document.getElementById('student-login-btn').disabled = false;
            }
        });

        // Admin login form
        document.getElementById('admin-login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            
            // Show loading state
            document.getElementById('admin-login-text').classList.add('hidden');
            document.getElementById('admin-login-spinner').classList.remove('hidden');
            document.getElementById('admin-login-btn').disabled = true;
            
            try {
                const result = await callApi('adminLogin', { username, password });
                
                if (result.success) {
                    await loadAllPayments();
                    showView('admin-dashboard-view');
                    updateNav('admin-dashboard');
                } else {
                    showAlert('admin-login-alert', result.message, 'error');
                }
            } catch (error) {
                showAlert('admin-login-alert', 'An error occurred. Please try again.', 'error');
            } finally {
                // Hide loading state
                document.getElementById('admin-login-text').classList.remove('hidden');
                document.getElementById('admin-login-spinner').classList.add('hidden');
                document.getElementById('admin-login-btn').disabled = false;
            }
        });

        // Admin search
        document.getElementById('admin-search').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            filterPayments(searchTerm);
        });

        // Add payment form
        document.getElementById('add-payment-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const record = {
                rollNumber: document.getElementById('new-roll-number').value,
                studentName: document.getElementById('new-student-name').value,
                amount: document.getElementById('new-amount').value,
                paymentDate: document.getElementById('new-payment-date').value
            };
            
            try {
                const result = await callApi('addPaymentRecord', { record });
                
                if (result.success) {
                    // Refresh the payments list
                    await loadAllPayments();
                    // Reset the form
                    document.getElementById('add-payment-form').reset();
                } else {
                    alert('Error adding payment: ' + result.message);
                }
            } catch (error) {
                alert('An error occurred. Please try again.');
            }
        });

        // API call function
        async function callApi(action, data = {}) {
            // For demo purposes, we'll simulate API calls
            // In a real implementation, you would fetch from your Google Apps Script URL
            return await simulateApiCall(action, data);
        }

        // Simulate API calls for demo
        async function simulateApiCall(action, data) {
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 800));
            
            // Sample data for demonstration
            const samplePayments = [
                { recordId: 'REC1', rollNumber: '12345', studentName: 'John Smith', amount: '120', paymentDate: '2023-09-05', status: 'Verified' },
                { recordId: 'REC2', rollNumber: '12345', studentName: 'John Smith', amount: '120', paymentDate: '2023-08-03', status: 'Verified' },
                { recordId: 'REC3', rollNumber: '12345', studentName: 'John Smith', amount: '120', paymentDate: '2023-07-06', status: 'Verified' },
                { recordId: 'REC4', rollNumber: '12345', studentName: 'John Smith', amount: '120', paymentDate: '', status: 'Pending' },
                { recordId: 'REC5', rollNumber: '12346', studentName: 'Emma Johnson', amount: '120', paymentDate: '2023-09-10', status: 'Paid' }
            ];
            
            switch(action) {
                case "studentLogin":
                    if (data.rollNumber === '12345') {
                        return { 
                            success: true, 
                            student: { 
                                rollNumber: '12345', 
                                name: 'John Smith' 
                            } 
                        };
                    } else if (data.rollNumber === '12346') {
                        return { 
                            success: true, 
                            student: { 
                                rollNumber: '12346', 
                                name: 'Emma Johnson' 
                            } 
                        };
                    } else {
                        return { success: false, message: "Student not found" };
                    }
                    
                case "adminLogin":
                    if (data.username === 'admin' && data.password === 'admin123') {
                        return { success: true };
                    } else {
                        return { success: false, message: "Invalid credentials" };
                    }
                    
                case "getPaymentHistory":
                    const studentPayments = samplePayments.filter(p => p.rollNumber === data.rollNumber);
                    return { success: true, payments: studentPayments };
                    
                case "getAllRecords":
                    return { success: true, records: samplePayments };
                    
                case "addPaymentRecord":
                    const newRecordId = 'REC' + (samplePayments.length + 1);
                    return { success: true, recordId: newRecordId };
                    
                case "verifyPayment":
                    return { success: true };
                    
                default:
                    return { success: false, message: "Invalid action" };
            }
        }

        // Load student payments
        async function loadStudentPayments(rollNumber) {
            try {
                const result = await callApi('getPaymentHistory', { rollNumber });
                
                if (result.success) {
                    displayStudentPayments(result.payments);
                } else {
                    console.error('Error loading payments:', result.message);
                }
            } catch (error) {
                console.error('Error loading payments:', error);
            }
        }

        // Load all payments for admin
        async function loadAllPayments() {
            try {
                const result = await callApi('getAllRecords');
                
                if (result.success) {
                    allPayments = result.records;
                    displayAdminPayments(allPayments);
                    updateAdminStats(allPayments);
                } else {
                    console.error('Error loading payments:', result.message);
                }
            } catch (error) {
                console.error('Error loading payments:', error);
            }
        }

        // Display student payments
        function displayStudentPayments(payments) {
            const tbody = document.getElementById('payment-history-body');
            tbody.innerHTML = '';
            
            if (payments && payments.length > 0) {
                document.getElementById('payment-history-container').classList.remove('hidden');
                document.getElementById('no-payments-message').classList.add('hidden');
                
                payments.forEach(payment => {
                    const row = document.createElement('tr');
                    
                    // Extract month from the record (assuming format "Month Year")
                    const month = getMonthFromRecord(payment);
                    
                    row.innerHTML = `
                        <td>${month}</td>
                        <td>$${payment.amount}</td>
                        <td>${payment.paymentDate || 'Not Paid'}</td>
                        <td><span class="status-badge ${getStatusClass(payment.status)}">${payment.status}</span></td>
                    `;
                    
                    tbody.appendChild(row);
                });
            } else {
                document.getElementById('payment-history-container').classList.add('hidden');
                document.getElementById('no-payments-message').classList.remove('hidden');
            }
        }

        // Helper function to extract month from payment record
        function getMonthFromRecord(payment) {
            if (!payment.paymentDate) return 'Unknown';
            
            try {
                const date = new Date(payment.paymentDate);
                const months = ["January", "February", "March", "April", "May", "June", 
                              "July", "August", "September", "October", "November", "December"];
                
                return months[date.getMonth()] + ' ' + date.getFullYear();
            } catch (e) {
                return 'Unknown';
            }
        }

        // Display admin payments
        function displayAdminPayments(payments) {
            const tbody = document.getElementById('admin-payments-body');
            tbody.innerHTML = '';
            
            if (payments && payments.length > 0) {
                document.getElementById('admin-payments-container').classList.remove('hidden');
                document.getElementById('no-admin-payments-message').classList.add('hidden');
                
                payments.forEach(payment => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${payment.recordId}</td>
                        <td>${payment.rollNumber}</td>
                        <td>${payment.studentName}</td>
                        <td>$${payment.amount}</td>
                        <td>${payment.paymentDate || 'Not Paid'}</td>
                        <td><span class="status-badge ${getStatusClass(payment.status)}">${payment.status}</span></td>
                        <td>
                            ${payment.status === 'Pending' ? 
                                `<button class="btn btn-primary" onclick="verifyPayment('${payment.recordId}')">Verify</button>` : 
                                `<button class="btn btn-secondary" onclick="updatePayment('${payment.recordId}')">Update</button>`
                            }
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
            } else {
                document.getElementById('admin-payments-container').classList.add('hidden');
                document.getElementById('no-admin-payments-message').classList.remove('hidden');
            }
        }

        // Filter payments based on search term
        function filterPayments(searchTerm) {
            if (!searchTerm) {
                displayAdminPayments(allPayments);
                return;
            }
            
            const filtered = allPayments.filter(payment => 
                payment.rollNumber.toLowerCase().includes(searchTerm) ||
                payment.studentName.toLowerCase().includes(searchTerm)
            );
            
            displayAdminPayments(filtered);
        }

        // Update admin stats
        function updateAdminStats(payments) {
            // Calculate total students (unique roll numbers)
            const uniqueRollNumbers = new Set(payments.map(p => p.rollNumber));
            document.getElementById('total-students').textContent = uniqueRollNumbers.size;
            
            // Calculate total payments
            const totalAmount = payments
                .filter(p => p.status === 'Verified' || p.status === 'Paid')
                .reduce((sum, payment) => sum + parseFloat(payment.amount), 0);
            document.getElementById('total-payments').textContent = `$${totalAmount.toFixed(2)}`;
            
            // Calculate payment completion rate
            const paidCount = payments.filter(p => p.status === 'Verified' || p.status === 'Paid').length;
            const completionRate = payments.length > 0 ? Math.round((paidCount / payments.length) * 100) : 0;
            document.getElementById('payment-completion').textContent = `${completionRate}%`;
        }

        // Verify payment
        async function verifyPayment(recordId) {
            try {
                const result = await callApi('verifyPayment', { recordId });
                
                if (result.success) {
                    // Refresh the payments list
                    await loadAllPayments();
                    alert('Payment verified successfully!');
                } else {
                    alert('Error verifying payment: ' + result.message);
                }
            } catch (error) {
                alert('An error occurred. Please try again.');
            }
        }

        // Update payment
        async function updatePayment(recordId) {
            // In a real app, this would open a modal for editing
            const newAmount = prompt('Enter new amount:');
            if (newAmount) {
                try {
                    // In a real implementation, you would call the API to update the record
                    alert(`Payment ${recordId} updated to $${newAmount}`);
                    // Refresh the payments list
                    await loadAllPayments();
                } catch (error) {
                    alert('An error occurred. Please try again.');
                }
            }
        }

        // Get status class for styling
        function getStatusClass(status) {
            switch (status) {
                case 'Paid':
                case 'Verified':
                    return 'status-paid';
                case 'Pending':
                    return 'status-pending';
                default:
                    return '';
            }
        }

        // Show alert message
        function showAlert(alertId, message, type) {
            const alert = document.getElementById(alertId);
            alert.textContent = message;
            alert.classList.remove('alert-error', 'alert-success', 'hidden');
            
            if (type === 'error') {
                alert.classList.add('alert-error');
            } else if (type === 'success') {
                alert.classList.add('alert-success');
            }
        }

        // Show specific view
        function showView(viewId) {
            // Hide all views
            document.querySelectorAll('.view').forEach(view => {
                view.classList.add('hidden');
            });
            
            // Show the requested view
            document.getElementById(viewId).classList.remove('hidden');
        }

        // Update navigation
        function updateNav(active) {
            // Reset all nav items
            homeLink.classList.remove('active');
            studentLink.classList.remove('active');
            adminLink.classList.remove('active');
            logoutLink.classList.add('hidden');
            
            // Set active nav item
            switch (active) {
                case 'home':
                    homeLink.classList.add('active');
                    break;
                case 'student':
                case 'student-dashboard':
                    studentLink.classList.add('active');
                    logoutLink.classList.remove('hidden');
                    break;
                case 'admin':
                case 'admin-dashboard':
                    adminLink.classList.add('active');
                    logoutLink.classList.remove('hidden');
                    break;
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set default values for demo
            document.getElementById('admin-username').value = 'admin';
            document.getElementById('admin-password').value = 'admin123';
            document.getElementById('roll-number').value = '12345';
        });
    </script>
</body>
</html>
