<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Gallery</title>
    <style>
        body { font-family: sans-serif; background-color: #f0f2f5; margin: 0; }
        header { background-color: #fff; padding: 20px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .gallery-container { max-width: 1200px; margin: 20px auto; padding: 20px; display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .video-card { background: #fff; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); overflow: hidden; }
        .video-card video { width: 100%; display: block; }
        .video-info { padding: 15px; }
        .video-info h3 { margin: 0 0 10px; }
        .share-btn { background-color: #28a745; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; width: 100%; }
        .share-btn:hover { background-color: #218838; }
        #loading { text-align: center; font-size: 1.2em; padding: 40px; }
    </style>
</head>
<body>

    <header>
        <h1>Our Video Collection</h1>
    </header>

    <div id="video-gallery" class="gallery-container">
        <div id="loading">Loading videos...</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";
        
        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyBDfUlGCHgBjGWNlLQcrRio5xaBjEadRkQ",
          authDomain: "video-of-fan.firebaseapp.com",
          projectId: "video-of-fan",
          storageBucket: "video-of-fan.appspot.com", // Corrected the storage bucket URL
          messagingSenderId: "60721213995",
          appId: "1:60721213995:web:019d65235e3089bd02b06e",
          measurementId: "G-MQQDH704K2"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        const gallery = document.getElementById('video-gallery');
        const loadingDiv = document.getElementById('loading');

        // ---- LOAD AND DISPLAY VIDEOS ----
        async function loadAndDisplayVideos() {
            const querySnapshot = await getDocs(collection(db, 'videos'));
            
            loadingDiv.style.display = 'none'; // Hide loading message

            if (querySnapshot.empty) {
                gallery.innerHTML = '<p>No videos available right now.</p>';
                return;
            }

            querySnapshot.forEach((doc) => {
                const video = doc.data();
                const card = document.createElement('div');
                card.className = 'video-card';
                card.innerHTML = `
                    <video controls preload="metadata">
                        <source src="${video.url}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <div class="video-info">
                        <h3>${video.title}</h3>
                        <button class="share-btn" data-title="${video.title}" data-url="${window.location.href}">Share</button>
                    </div>
                `;
                gallery.appendChild(card);
            });
        }
        
        // ---- SHARE LOGIC ----
        gallery.addEventListener('click', (e) => {
            if (e.target.classList.contains('share-btn')) {
                const title = e.target.dataset.title;
                const url = e.target.dataset.url;

                if (navigator.share) { // Use Web Share API if available
                    navigator.share({
                        title: `Check out this video: ${title}`,
                        text: `I found this cool video, "${title}"!`,
                        url: url,
                    }).catch(console.error);
                } else { // Fallback for desktop/unsupported browsers
                    alert(`Share this link:\n${url}`);
                }
            }
        });

        // Initial load
        loadAndDisplayVideos();
    </script>
</body>
</html>
